<!DOCTYPE html>
<head>
    <!-- Bootstrap js -->
    <script src="https://code.jquery.com/jquery-3.2.1.min.js" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
    
    <script>
    var API_X;
    var API_Y;

    function getJsonData() {
        $.ajax({                       
            url: "http://127.0.0.1:3000/api",
            type: 'get',
            cache: false,
            success: function (data) {
                API_X = data["X"];
                API_Y = data["Y"];


                document.getElementById("x").innerHTML = `X : ${data["X"]}`;
                document.getElementById("y").innerHTML = `Y : ${data["Y"]}`;
                document.getElementById("z").innerHTML = `Z : ${data["Z"]}`;
            },
            error: function() { 
             console.log("API request has a error (Can't Get Data)");
            }   
        });       
    }
   
    window.setInterval(getJsonData, 500); /* this checks the flag every 100 milliseconds*/

    </script>
    <style>
        canvas {
            border:1px solid #d3d3d3;
            background-color: #f1f1f1;
        }
    </style>
</head>
<html>
    <body onload="startGame()">
        <script>
            var myGamePiece;
            
            function startGame() {
                myGamePiece = new component(30, 30, "red", 750, 250);
                myGameArea.start();
            }
            
            var myGameArea = {
                canvas : document.createElement("canvas"),
                start : function() {
                    this.canvas.width = 1500;
                    this.canvas.height = 500;
                    this.context = this.canvas.getContext("2d");
                    document.body.insertBefore(this.canvas, document.body.childNodes[0]);
                    this.interval = setInterval(updateGameArea, 20);
                },
                clear : function() {
                    this.context.clearRect(0, 0, this.canvas.width, this.canvas.height);
                }
            }
            
            function component(width, height, color, x, y) {
                this.width = width;
                this.height = height;
                this.speedX = 0;
                this.speedY = 0;
                this.x = x;
                this.y = y;    
                this.update = function() {
                    ctx = myGameArea.context;
                    ctx.fillStyle = color;
                    ctx.fillRect(this.x, this.y, this.width, this.height);
                }
                this.newPos = function() 
                {
                    if (API_X > 0)
                    {
                        this.x += 1;
                    }
                    else if (API_X < 0)
                    {
                        this.x -= 1;
                    }
                    
                    if (API_Y > 0)
                    {
                        this.y -= 1;
                    }
                    else if (API_Y < 0)
                    {
                        this.y += 1;
                    }     
                }    
            }
            
            function updateGameArea() 
            {

                if (API_X == undefined)
                {
                    API_X = 0;
                }
                if (API_Y == undefined)
                {
                    API_Y = 0;
                }
                myGameArea.clear();
                myGamePiece.newPos();    
                myGamePiece.update();
                
            }
            
        </script>

    <h1>Accelerometer Data</h1>
    <h3 id="x">X : 0</h3>
    <h3 id="y">Y : 0</h3>
    <h3 id="z">Z : 0</h3>
    </body>
</html>
